#!/bin/sh
hcitool scan | grep -v Scanning | awk '{print $1" "$2" "$3" "$4}' > /tmp/bt_dev.lst

export menu='<vbox>
<list>
	<variable>"BT_DEV"</variable>
	<input file>/tmp/bt_dev.lst</input>
</list>
<button ok></button>
</vbox>'
eval $(gtkdialog -c --program "menu")
[ "$BT_DEV" ] || exit

BDA=$(echo "$BT_DEV" | awk '{print $1}')
sdptool browse $BDA > /tmp/${BDA}-info.lst
awk -F[\(\)] '/0x11/ {print $2}' /tmp/${BDA}-info.lst | sort -u | while read S
do
CH=$(grep -A4 $S /tmp/${BDA}-info.lst | awk '/Channel/ {print $2}')
case $S in
0x1101) echo "<frame Serial Port>
 <button>
 </button>
</frame>
" >> /tmp/panel ;;
0x1103) echo "<frame Dialup Networking>
 <button>
 </button>
</frame>
" >> /tmp/panel ;;
0x1105) echo "<frame OBEX Object Push>
 <button>
 </button>
</frame>
" >> /tmp/panel 
#Command \"ussp-push ${BDA}@{$CH} LFILE RFILE\""
;;
0x1106) echo "<frame OBEX File Transfer>
 <button>
 </button>
</frame>
" >> /tmp/panel 
#Command \"obexfs -b $BDA -B $CH\""
;;
0x1112) echo "<frame Headset Audio Gateway>
 <button>
 </button>
</frame>
" >> /tmp/panel ;;
0x111f) PANEL="<frame Handsfree Audio Gateway>
 <button>
 </button>
</frame>
" >> /tmp/panel ;;
0x110a) echo "<frame Audio Source>
 <button>
 </button>
</frame>
" >> /tmp/panel ;;
0x110c) echo "<frame AV Remote Target>
 <button>
 </button>
</frame>
" >> /tmp/panel ;;
# и т д
esac
done

export panel="<vbox>
`cat /tmp/panel` </vbox>"
gtkdialog -c --program "panel"
